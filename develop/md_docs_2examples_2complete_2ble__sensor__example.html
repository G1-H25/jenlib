<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>jenlib: JenLib Example Usage Guide</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">jenlib
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">JenLib Example Usage Guide</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md17"></a> This guide demonstrates how to use JenLib's pin, event, and callback systems to read sensor values and transmit them over BLE, based on the Arduino BLE sensor example.</p>
<h1><a class="anchor" id="autotoc_md18"></a>
Overview</h1>
<p>The example shows a complete sensor node that:</p><ol type="1">
<li>Reads temperature and humidity values from sensors</li>
<li>Uses a state machine to manage measurement sessions</li>
<li>Transmits readings over BLE when requested by a broker</li>
<li>Handles connection state changes and message acknowledgments</li>
</ol>
<h1><a class="anchor" id="autotoc_md19"></a>
Hardware</h1>
<p>The example uses a TMP36 sensor. Readings are calculated from an input analog voltage. The calculation result will depend on the reference voltage.</p>
<h1><a class="anchor" id="autotoc_md20"></a>
Key Components</h1>
<h2><a class="anchor" id="autotoc_md21"></a>
1. Pin System (GPIO)</h2>
<p>The <a class="el" href="namespaceGPIO.html" title="Public GPIO API providing Arduino-compatible interface.">GPIO</a> system provides hardware abstraction for reading sensor values:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="GPIO_8h.html">jenlib/gpio/GPIO.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="ArduinoGpioDriver_8h.html">jenlib/gpio/drivers/ArduinoGpioDriver.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Initialize GPIO driver</span></div>
<div class="line"><span class="keyword">static</span> <a class="code hl_class" href="classjenlib_1_1gpio_1_1ArduinoGpioDriver.html">jenlib::gpio::ArduinoGpioDriver</a> gpio_driver;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Configure GPIO system</span></div>
<div class="line"><span class="keywordtype">void</span> setup_gpio() {</div>
<div class="line">    <a class="code hl_function" href="namespaceGPIO.html#a6fd69e8b262a86e3ad5a4d273d958a17">GPIO::setDriver</a>(&amp;gpio_driver);</div>
<div class="line">    <a class="code hl_function" href="namespaceGPIO.html#a5a7668181ca7c5dd6dff03d018d2fe06">GPIO::setAnalogReadResolution</a>(10);  <span class="comment">// 10-bit ADC resolution</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Read TMP36 temperature sensor on pin A0</span></div>
<div class="line"><span class="keywordtype">float</span> read_temperature_sensor() {</div>
<div class="line">    <span class="comment">// Create pin handle for analog pin A0</span></div>
<div class="line">    <a class="code hl_class" href="classGPIO_1_1Pin.html">GPIO::Pin</a> temp_pin(A0);</div>
<div class="line">    temp_pin.pinMode(GPIO::PinMode::INPUT);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Read analog value (0-1023 for 10-bit ADC)</span></div>
<div class="line">    std::uint16_t analog_value = temp_pin.analogRead();</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Convert to voltage (assuming 5V reference)</span></div>
<div class="line">    <span class="keywordtype">float</span> voltage = (analog_value * 5.0f) / 1023.0f;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// TMP36 conversion: (voltage - 0.5) * 100 = temperature in Celsius</span></div>
<div class="line">    <span class="comment">// TMP36 outputs 10mV per degree C with 0.5V offset at 0°C</span></div>
<div class="line">    <span class="keywordtype">float</span> temperature_c = (voltage - 0.5f) * 100.0f;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> temperature_c;</div>
<div class="line">}</div>
<div class="ttc" id="aArduinoGpioDriver_8h_html"><div class="ttname"><a href="ArduinoGpioDriver_8h.html">ArduinoGpioDriver.h</a></div><div class="ttdoc">Arduino GPIO driver implementation.</div></div>
<div class="ttc" id="aGPIO_8h_html"><div class="ttname"><a href="GPIO_8h.html">GPIO.h</a></div><div class="ttdoc">Public wrapper API for GPIO operations.</div></div>
<div class="ttc" id="aclassGPIO_1_1Pin_html"><div class="ttname"><a href="classGPIO_1_1Pin.html">GPIO::Pin</a></div><div class="ttdoc">Lightweight handle to a GPIO pin; forwards calls to the active driver.</div><div class="ttdef"><b>Definition</b> GPIO.h:66</div></div>
<div class="ttc" id="aclassjenlib_1_1gpio_1_1ArduinoGpioDriver_html"><div class="ttname"><a href="classjenlib_1_1gpio_1_1ArduinoGpioDriver.html">jenlib::gpio::ArduinoGpioDriver</a></div><div class="ttdef"><b>Definition</b> ArduinoGpioDriver.h:43</div></div>
<div class="ttc" id="anamespaceGPIO_html_a5a7668181ca7c5dd6dff03d018d2fe06"><div class="ttname"><a href="namespaceGPIO.html#a5a7668181ca7c5dd6dff03d018d2fe06">GPIO::setAnalogReadResolution</a></div><div class="ttdeci">void setAnalogReadResolution(std::uint8_t bits) noexcept</div><div class="ttdoc">Configure analog conversion and PWM resolution for the platform.</div><div class="ttdef"><b>Definition</b> GPIO.cpp:54</div></div>
<div class="ttc" id="anamespaceGPIO_html_a6fd69e8b262a86e3ad5a4d273d958a17"><div class="ttname"><a href="namespaceGPIO.html#a6fd69e8b262a86e3ad5a4d273d958a17">GPIO::setDriver</a></div><div class="ttdeci">void setDriver(jenlib::gpio::GpioDriver *driver) noexcept</div><div class="ttdoc">Driver injection for testability and portability.</div><div class="ttdef"><b>Definition</b> GPIO.cpp:74</div></div>
</div><!-- fragment --><p><b>Key Points:</b></p><ul>
<li>Use platform-specific drivers (ArduinoGpioDriver for Arduino)</li>
<li>Configure ADC resolution for accurate analog readings</li>
<li>TMP36 sensor provides linear voltage output (10mV/°C with 0.5V offset)</li>
<li>The library provides <a class="el" href="namespaceGPIO.html" title="Public GPIO API providing Arduino-compatible interface.">GPIO</a> abstraction, sensor-specific conversion is in application code</li>
<li>Pin A0 is used for analog input (ADC) on most Arduino boards</li>
</ul>
<h2><a class="anchor" id="autotoc_md22"></a>
2. Event System</h2>
<p>The event system enables decoupled communication between components:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="EventDispatcher_8h.html">jenlib/events/EventDispatcher.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Global event dispatcher</span></div>
<div class="line"><a class="code hl_class" href="classjenlib_1_1events_1_1EventDispatcher.html">jenlib::events::EventDispatcher</a> event_dispatcher;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Register event handlers</span></div>
<div class="line">event_dispatcher.<a class="code hl_function" href="classjenlib_1_1events_1_1EventDispatcher.html#a724b3efb19d9603fe881c3f790c8c932">register_callback</a>(</div>
<div class="line">    <a class="code hl_enumvalue" href="namespacejenlib_1_1events.html#a9f85d809f6bfbfff4fc5e9aa75cdefdca88760498e9a978536dedff1b9122e31a">jenlib::events::EventType::kBleMessage</a>,</div>
<div class="line">    handle_ble_message_event);</div>
<div class="line">event_dispatcher.<a class="code hl_function" href="classjenlib_1_1events_1_1EventDispatcher.html#a724b3efb19d9603fe881c3f790c8c932">register_callback</a>(</div>
<div class="line">    <a class="code hl_enumvalue" href="namespacejenlib_1_1events.html#a9f85d809f6bfbfff4fc5e9aa75cdefdcaad8d57a86ec37372ff97bb4b3eb0ea3e">jenlib::events::EventType::kConnectionStateChange</a>,</div>
<div class="line">    handle_connection_state_event);</div>
<div class="line">event_dispatcher.<a class="code hl_function" href="classjenlib_1_1events_1_1EventDispatcher.html#a724b3efb19d9603fe881c3f790c8c932">register_callback</a>(</div>
<div class="line">    <a class="code hl_enumvalue" href="namespacejenlib_1_1events.html#a9f85d809f6bfbfff4fc5e9aa75cdefdca31443d74657c91a8b1bf709f49116ac1">jenlib::events::EventType::kTimeTick</a>,</div>
<div class="line">    handle_time_tick_event);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Process events in main loop</span></div>
<div class="line"><span class="keywordtype">void</span> loop() {</div>
<div class="line">    event_dispatcher.<a class="code hl_function" href="classjenlib_1_1events_1_1EventDispatcher.html#a3db74a0fdb257c91ff1e8c4bad1fdf90">process_events</a>();</div>
<div class="line">    <span class="comment">// ... other processing</span></div>
<div class="line">}</div>
<div class="ttc" id="aEventDispatcher_8h_html"><div class="ttname"><a href="EventDispatcher_8h.html">EventDispatcher.h</a></div><div class="ttdoc">Event dispatcher for managing and processing events.</div></div>
<div class="ttc" id="aclassjenlib_1_1events_1_1EventDispatcher_html"><div class="ttname"><a href="classjenlib_1_1events_1_1EventDispatcher.html">jenlib::events::EventDispatcher</a></div><div class="ttdoc">Event dispatcher for managing and processing events.</div><div class="ttdef"><b>Definition</b> EventDispatcher.h:73</div></div>
<div class="ttc" id="aclassjenlib_1_1events_1_1EventDispatcher_html_a3db74a0fdb257c91ff1e8c4bad1fdf90"><div class="ttname"><a href="classjenlib_1_1events_1_1EventDispatcher.html#a3db74a0fdb257c91ff1e8c4bad1fdf90">jenlib::events::EventDispatcher::process_events</a></div><div class="ttdeci">static std::size_t process_events()</div><div class="ttdoc">Process all pending events in the queue.</div><div class="ttdef"><b>Definition</b> EventDispatcher.cpp:98</div></div>
<div class="ttc" id="aclassjenlib_1_1events_1_1EventDispatcher_html_a724b3efb19d9603fe881c3f790c8c932"><div class="ttname"><a href="classjenlib_1_1events_1_1EventDispatcher.html#a724b3efb19d9603fe881c3f790c8c932">jenlib::events::EventDispatcher::register_callback</a></div><div class="ttdeci">static EventId register_callback(EventType event_type, EventCallback callback)</div><div class="ttdoc">Register a callback for a specific event type.</div><div class="ttdef"><b>Definition</b> EventDispatcher.cpp:21</div></div>
<div class="ttc" id="anamespacejenlib_1_1events_html_a9f85d809f6bfbfff4fc5e9aa75cdefdca31443d74657c91a8b1bf709f49116ac1"><div class="ttname"><a href="namespacejenlib_1_1events.html#a9f85d809f6bfbfff4fc5e9aa75cdefdca31443d74657c91a8b1bf709f49116ac1">jenlib::events::EventType::kTimeTick</a></div><div class="ttdeci">@ kTimeTick</div><div class="ttdoc">Periodic timer events.</div></div>
<div class="ttc" id="anamespacejenlib_1_1events_html_a9f85d809f6bfbfff4fc5e9aa75cdefdca88760498e9a978536dedff1b9122e31a"><div class="ttname"><a href="namespacejenlib_1_1events.html#a9f85d809f6bfbfff4fc5e9aa75cdefdca88760498e9a978536dedff1b9122e31a">jenlib::events::EventType::kBleMessage</a></div><div class="ttdeci">@ kBleMessage</div><div class="ttdoc">BLE message received.</div></div>
<div class="ttc" id="anamespacejenlib_1_1events_html_a9f85d809f6bfbfff4fc5e9aa75cdefdcaad8d57a86ec37372ff97bb4b3eb0ea3e"><div class="ttname"><a href="namespacejenlib_1_1events.html#a9f85d809f6bfbfff4fc5e9aa75cdefdcaad8d57a86ec37372ff97bb4b3eb0ea3e">jenlib::events::EventType::kConnectionStateChange</a></div><div class="ttdeci">@ kConnectionStateChange</div><div class="ttdoc">BLE connection state change.</div></div>
</div><!-- fragment --><p><b>Event Types:</b></p><ul>
<li><code>kBleMessage</code>: BLE communication events</li>
<li><code>kConnectionStateChange</code>: Connection status changes</li>
<li><code>kTimeTick</code>: Timer-based events</li>
</ul>
<h2><a class="anchor" id="autotoc_md23"></a>
3. Callback System (BLE)</h2>
<p>The BLE callback system handles incoming messages and connection changes:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="ArduinoBleDriver_8h.html">jenlib/ble/drivers/ArduinoBleDriver.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="Roles_8h.html">jenlib/ble/Roles.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Define device identity</span></div>
<div class="line"><span class="keyword">constexpr</span> <a class="code hl_class" href="classjenlib_1_1ble_1_1DeviceId.html">jenlib::ble::DeviceId</a> kDeviceId = <a class="code hl_class" href="classjenlib_1_1ble_1_1DeviceId.html">jenlib::ble::DeviceId</a>(0x12345678);</div>
<div class="line"><span class="keyword">static</span> <a class="code hl_class" href="classjenlib_1_1ble_1_1Sensor.html">jenlib::ble::Sensor</a> sensor(kDeviceId);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Configure BLE callbacks</span></div>
<div class="line">sensor.configure_callbacks(<a class="code hl_struct" href="structjenlib_1_1ble_1_1BleCallbacks.html">jenlib::ble::BleCallbacks</a>{</div>
<div class="line">    .<a class="code hl_variable" href="structjenlib_1_1ble_1_1BleCallbacks.html#a5a075b66b0af302fd58eeae763e0bc47">on_connection</a> = callback_connection,</div>
<div class="line">    .on_start = callback_start,</div>
<div class="line">    .on_receipt = callback_receipt,</div>
<div class="line">    .on_generic = callback_generic,</div>
<div class="line">});</div>
<div class="ttc" id="aArduinoBleDriver_8h_html"><div class="ttname"><a href="ArduinoBleDriver_8h.html">ArduinoBleDriver.h</a></div><div class="ttdoc">Arduino BLE driver implementation using ArduinoBLE library.</div></div>
<div class="ttc" id="aRoles_8h_html"><div class="ttname"><a href="Roles_8h.html">Roles.h</a></div><div class="ttdoc">Minimal role-based API for student-facing apps (Sensor/Broker). Copyright 2025 Jennifer Gott.</div></div>
<div class="ttc" id="aclassjenlib_1_1ble_1_1DeviceId_html"><div class="ttname"><a href="classjenlib_1_1ble_1_1DeviceId.html">jenlib::ble::DeviceId</a></div><div class="ttdoc">Device identifier type.</div><div class="ttdef"><b>Definition</b> Ids.h:36</div></div>
<div class="ttc" id="aclassjenlib_1_1ble_1_1Sensor_html"><div class="ttname"><a href="classjenlib_1_1ble_1_1Sensor.html">jenlib::ble::Sensor</a></div><div class="ttdoc">Simple Sensor application facade.</div><div class="ttdef"><b>Definition</b> Roles.h:78</div></div>
<div class="ttc" id="astructjenlib_1_1ble_1_1BleCallbacks_html"><div class="ttname"><a href="structjenlib_1_1ble_1_1BleCallbacks.html">jenlib::ble::BleCallbacks</a></div><div class="ttdoc">Aggregate callbacks for one-shot configuration.</div><div class="ttdef"><b>Definition</b> BleDriver.h:46</div></div>
<div class="ttc" id="astructjenlib_1_1ble_1_1BleCallbacks_html_a5a075b66b0af302fd58eeae763e0bc47"><div class="ttname"><a href="structjenlib_1_1ble_1_1BleCallbacks.html#a5a075b66b0af302fd58eeae763e0bc47">jenlib::ble::BleCallbacks::on_connection</a></div><div class="ttdeci">ConnectionCallback on_connection</div><div class="ttdef"><b>Definition</b> BleDriver.h:47</div></div>
</div><!-- fragment --><p><b>Callback Functions:</b></p>
<h3><a class="anchor" id="autotoc_md24"></a>
Connection Callback</h3>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> callback_connection(<span class="keywordtype">bool</span> connected) {</div>
<div class="line">    <span class="comment">// Update state machine first</span></div>
<div class="line">    sensor_state_machine.handle_connection_change(connected);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Dispatch event for other systems</span></div>
<div class="line">    <a class="code hl_struct" href="structjenlib_1_1events_1_1Event.html">jenlib::events::Event</a> event(</div>
<div class="line">        <a class="code hl_enumvalue" href="namespacejenlib_1_1events.html#a9f85d809f6bfbfff4fc5e9aa75cdefdcaad8d57a86ec37372ff97bb4b3eb0ea3e">jenlib::events::EventType::kConnectionStateChange</a>,</div>
<div class="line">        <a class="code hl_function" href="classjenlib_1_1time_1_1Time.html#aebe427fd822c10516e2c18b0bca7f30c">jenlib::time::Time::now</a>(),</div>
<div class="line">        connected ? 1 : 0);</div>
<div class="line">    event_dispatcher.<a class="code hl_function" href="classjenlib_1_1events_1_1EventDispatcher.html#a57ed245363930f6cb8a9e42d1d3283ae">dispatch_event</a>(event);</div>
<div class="line">}</div>
<div class="ttc" id="aclassjenlib_1_1events_1_1EventDispatcher_html_a57ed245363930f6cb8a9e42d1d3283ae"><div class="ttname"><a href="classjenlib_1_1events_1_1EventDispatcher.html#a57ed245363930f6cb8a9e42d1d3283ae">jenlib::events::EventDispatcher::dispatch_event</a></div><div class="ttdeci">static EventEnqueueResult dispatch_event(const Event &amp;event, Event *evicted_event=nullptr)</div><div class="ttdoc">Dispatch an event to the processing queue.</div><div class="ttdef"><b>Definition</b> EventDispatcher.cpp:75</div></div>
<div class="ttc" id="aclassjenlib_1_1time_1_1Time_html_aebe427fd822c10516e2c18b0bca7f30c"><div class="ttname"><a href="classjenlib_1_1time_1_1Time.html#aebe427fd822c10516e2c18b0bca7f30c">jenlib::time::Time::now</a></div><div class="ttdeci">static std::uint32_t now()</div><div class="ttdoc">Get current time in milliseconds (platform-specific)</div><div class="ttdef"><b>Definition</b> Time.cpp:111</div></div>
<div class="ttc" id="astructjenlib_1_1events_1_1Event_html"><div class="ttname"><a href="structjenlib_1_1events_1_1Event.html">jenlib::events::Event</a></div><div class="ttdoc">Generic event structure for the event system.</div><div class="ttdef"><b>Definition</b> EventTypes.h:25</div></div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md25"></a>
Start Measurement Callback</h3>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> callback_start(<a class="code hl_class" href="classjenlib_1_1ble_1_1DeviceId.html">jenlib::ble::DeviceId</a> sender_id,</div>
<div class="line">                   <span class="keyword">const</span> <a class="code hl_struct" href="structjenlib_1_1ble_1_1StartBroadcastMsg.html">jenlib::ble::StartBroadcastMsg</a> &amp;msg) {</div>
<div class="line">    <span class="comment">// Check if message is for this device</span></div>
<div class="line">    <span class="keywordflow">if</span> (msg.<a class="code hl_variable" href="structjenlib_1_1ble_1_1StartBroadcastMsg.html#a740ca9c95f62b6917e75bf9e0ade1562">device_id</a> != kDeviceId) {</div>
<div class="line">        <span class="keywordflow">return</span>; <span class="comment">// Not for us</span></div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Validate state transition</span></div>
<div class="line">    <span class="keywordtype">bool</span> success = sensor_state_machine.handle_start_broadcast(sender_id, msg);</div>
<div class="line">    <span class="keywordflow">if</span> (success) {</div>
<div class="line">        start_measurement_session(msg);</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="ttc" id="astructjenlib_1_1ble_1_1StartBroadcastMsg_html"><div class="ttname"><a href="structjenlib_1_1ble_1_1StartBroadcastMsg.html">jenlib::ble::StartBroadcastMsg</a></div><div class="ttdoc">Broker to Sensor command to begin a measurement session.</div><div class="ttdef"><b>Definition</b> Messages.h:33</div></div>
<div class="ttc" id="astructjenlib_1_1ble_1_1StartBroadcastMsg_html_a740ca9c95f62b6917e75bf9e0ade1562"><div class="ttname"><a href="structjenlib_1_1ble_1_1StartBroadcastMsg.html#a740ca9c95f62b6917e75bf9e0ade1562">jenlib::ble::StartBroadcastMsg::device_id</a></div><div class="ttdeci">DeviceId device_id</div><div class="ttdoc">target sensor id</div><div class="ttdef"><b>Definition</b> Messages.h:34</div></div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md26"></a>
Complete Workflow</h1>
<h2><a class="anchor" id="autotoc_md27"></a>
1. Initialization (setup())</h2>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> setup() {</div>
<div class="line">    <span class="comment">// Initialize GPIO system</span></div>
<div class="line">    setup_gpio();</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Initialize time service</span></div>
<div class="line">    <a class="code hl_function" href="classjenlib_1_1time_1_1Time.html#a0695bfa42f2bb93cd724aeeb46108340">jenlib::time::Time::initialize</a>();</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Initialize BLE</span></div>
<div class="line">    sensor.begin();</div>
<div class="line">    sensor.configure_callbacks(<span class="comment">/* callbacks */</span>);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Register event handlers</span></div>
<div class="line">    event_dispatcher.<a class="code hl_function" href="classjenlib_1_1events_1_1EventDispatcher.html#a724b3efb19d9603fe881c3f790c8c932">register_callback</a>(<span class="comment">/* handlers */</span>);</div>
<div class="line">}</div>
<div class="ttc" id="aclassjenlib_1_1time_1_1Time_html_a0695bfa42f2bb93cd724aeeb46108340"><div class="ttname"><a href="classjenlib_1_1time_1_1Time.html#a0695bfa42f2bb93cd724aeeb46108340">jenlib::time::Time::initialize</a></div><div class="ttdeci">static void initialize()</div><div class="ttdoc">Initialize the time service (called automatically on first use)</div><div class="ttdef"><b>Definition</b> Time.cpp:149</div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md28"></a>
2. Main Loop (loop())</h2>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> loop() {</div>
<div class="line">    <span class="comment">// Process all event systems</span></div>
<div class="line">    event_dispatcher.<a class="code hl_function" href="classjenlib_1_1events_1_1EventDispatcher.html#a3db74a0fdb257c91ff1e8c4bad1fdf90">process_events</a>();</div>
<div class="line">    sensor.process_events();</div>
<div class="line">    <a class="code hl_function" href="classjenlib_1_1time_1_1Time.html#ad99783b7dacd8d3189a4c0eb64179ebd">jenlib::time::Time::process_timers</a>();</div>
<div class="line">}</div>
<div class="ttc" id="aclassjenlib_1_1time_1_1Time_html_ad99783b7dacd8d3189a4c0eb64179ebd"><div class="ttname"><a href="classjenlib_1_1time_1_1Time.html#ad99783b7dacd8d3189a4c0eb64179ebd">jenlib::time::Time::process_timers</a></div><div class="ttdeci">static std::size_t process_timers()</div><div class="ttdoc">Process all active timers.</div><div class="ttdef"><b>Definition</b> Time.cpp:72</div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md29"></a>
3. Measurement Session</h2>
<p>When a broker requests measurements:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> start_measurement_session(<span class="keyword">const</span> <a class="code hl_struct" href="structjenlib_1_1ble_1_1StartBroadcastMsg.html">jenlib::ble::StartBroadcastMsg</a>&amp; msg) {</div>
<div class="line">    <span class="comment">// Configure measurement interval</span></div>
<div class="line">    sensor_state_machine.set_measurement_interval_ms(1000);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Take immediate reading</span></div>
<div class="line">    take_and_broadcast_reading();</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Schedule recurring measurements</span></div>
<div class="line">    <a class="code hl_function" href="namespacejenlib_1_1time.html#a691716e383b2d681f3b7abe17be5b989">jenlib::time::schedule_repeating_timer</a>(</div>
<div class="line">        sensor_state_machine.get_measurement_interval_ms(),</div>
<div class="line">        handle_measurement_timer);</div>
<div class="line">}</div>
<div class="ttc" id="anamespacejenlib_1_1time_html_a691716e383b2d681f3b7abe17be5b989"><div class="ttname"><a href="namespacejenlib_1_1time.html#a691716e383b2d681f3b7abe17be5b989">jenlib::time::schedule_repeating_timer</a></div><div class="ttdeci">TimerId schedule_repeating_timer(std::uint32_t interval_ms, TimerCallback callback)</div><div class="ttdoc">Convenience function to schedule a repeating timer.</div><div class="ttdef"><b>Definition</b> Time.h:149</div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md30"></a>
4. Reading and Broadcasting</h2>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> take_and_broadcast_reading() {</div>
<div class="line">    <span class="keywordflow">if</span> (!sensor_state_machine.is_session_active()) {</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Read TMP36 temperature sensor</span></div>
<div class="line">    <span class="keywordtype">float</span> temperature_c = read_temperature_sensor();</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Create reading message (humidity set to 0 for TMP36-only setup)</span></div>
<div class="line">    <a class="code hl_struct" href="structjenlib_1_1ble_1_1ReadingMsg.html">jenlib::ble::ReadingMsg</a> reading_msg{</div>
<div class="line">        .<a class="code hl_variable" href="structjenlib_1_1ble_1_1ReadingMsg.html#a25361203fe13605bad5e910b6acf3386">sender_id</a> = kDeviceId,</div>
<div class="line">        .session_id = sensor_state_machine.get_current_session_id(),</div>
<div class="line">        .offset_ms = <a class="code hl_function" href="classjenlib_1_1time_1_1Time.html#aebe427fd822c10516e2c18b0bca7f30c">jenlib::time::Time::now</a>(),</div>
<div class="line">        .temperature_c_centi = <a class="code hl_function" href="namespacejenlib_1_1measurement.html#aa80ffd059bccbc20e96ea71d678ad4de">jenlib::measurement::temperature_to_centi</a>(temperature_c),</div>
<div class="line">        .humidity_bp = 0  <span class="comment">// No humidity sensor in this example</span></div>
<div class="line">    };</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Broadcast the reading</span></div>
<div class="line">    sensor.broadcast_reading(reading_msg);</div>
<div class="line">}</div>
<div class="ttc" id="anamespacejenlib_1_1measurement_html_aa80ffd059bccbc20e96ea71d678ad4de"><div class="ttname"><a href="namespacejenlib_1_1measurement.html#aa80ffd059bccbc20e96ea71d678ad4de">jenlib::measurement::temperature_to_centi</a></div><div class="ttdeci">std::int16_t temperature_to_centi(float temp_c)</div><div class="ttdoc">Convert temperature from float Celsius to centi-degrees (int16).</div><div class="ttdef"><b>Definition</b> Measurement.h:86</div></div>
<div class="ttc" id="astructjenlib_1_1ble_1_1ReadingMsg_html"><div class="ttname"><a href="structjenlib_1_1ble_1_1ReadingMsg.html">jenlib::ble::ReadingMsg</a></div><div class="ttdoc">Sensor to Broker measurement payload.</div><div class="ttdef"><b>Definition</b> Messages.h:46</div></div>
<div class="ttc" id="astructjenlib_1_1ble_1_1ReadingMsg_html_a25361203fe13605bad5e910b6acf3386"><div class="ttname"><a href="structjenlib_1_1ble_1_1ReadingMsg.html#a25361203fe13605bad5e910b6acf3386">jenlib::ble::ReadingMsg::sender_id</a></div><div class="ttdeci">DeviceId sender_id</div><div class="ttdoc">sensor id</div><div class="ttdef"><b>Definition</b> Messages.h:47</div></div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md31"></a>
State Machine Integration</h1>
<p>The state machine ensures proper operation flow:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="SensorStateMachine_8h.html">jenlib/state/SensorStateMachine.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><a class="code hl_class" href="classjenlib_1_1state_1_1SensorStateMachine.html">jenlib::state::SensorStateMachine</a> sensor_state_machine;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// State machine validates all operations</span></div>
<div class="line">sensor_state_machine.<a class="code hl_function" href="classjenlib_1_1state_1_1SensorStateMachine.html#a97c3437857c6b63003b959f3853f0487">handle_connection_change</a>(connected);</div>
<div class="line">sensor_state_machine.<a class="code hl_function" href="classjenlib_1_1state_1_1SensorStateMachine.html#a09648b2456a48c60de8d19d8ceeb7d94">handle_start_broadcast</a>(sender_id, msg);</div>
<div class="line">sensor_state_machine.<a class="code hl_function" href="classjenlib_1_1state_1_1SensorStateMachine.html#a699c5e167a2d74a4f5fb59863bbcc46c">handle_measurement_timer</a>();</div>
<div class="ttc" id="aSensorStateMachine_8h_html"><div class="ttname"><a href="SensorStateMachine_8h.html">SensorStateMachine.h</a></div><div class="ttdoc">Sensor state machine for BLE sensor applications.</div></div>
<div class="ttc" id="aclassjenlib_1_1state_1_1SensorStateMachine_html"><div class="ttname"><a href="classjenlib_1_1state_1_1SensorStateMachine.html">jenlib::state::SensorStateMachine</a></div><div class="ttdoc">Sensor state machine.</div><div class="ttdef"><b>Definition</b> SensorStateMachine.h:84</div></div>
<div class="ttc" id="aclassjenlib_1_1state_1_1SensorStateMachine_html_a09648b2456a48c60de8d19d8ceeb7d94"><div class="ttname"><a href="classjenlib_1_1state_1_1SensorStateMachine.html#a09648b2456a48c60de8d19d8ceeb7d94">jenlib::state::SensorStateMachine::handle_start_broadcast</a></div><div class="ttdeci">bool handle_start_broadcast(jenlib::ble::DeviceId sender_id, const jenlib::ble::StartBroadcastMsg &amp;msg)</div><div class="ttdoc">Handle start broadcast message.</div><div class="ttdef"><b>Definition</b> SensorStateMachine.cpp:53</div></div>
<div class="ttc" id="aclassjenlib_1_1state_1_1SensorStateMachine_html_a699c5e167a2d74a4f5fb59863bbcc46c"><div class="ttname"><a href="classjenlib_1_1state_1_1SensorStateMachine.html#a699c5e167a2d74a4f5fb59863bbcc46c">jenlib::state::SensorStateMachine::handle_measurement_timer</a></div><div class="ttdeci">bool handle_measurement_timer()</div><div class="ttdoc">Handle measurement timer event.</div><div class="ttdef"><b>Definition</b> SensorStateMachine.cpp:82</div></div>
<div class="ttc" id="aclassjenlib_1_1state_1_1SensorStateMachine_html_a97c3437857c6b63003b959f3853f0487"><div class="ttname"><a href="classjenlib_1_1state_1_1SensorStateMachine.html#a97c3437857c6b63003b959f3853f0487">jenlib::state::SensorStateMachine::handle_connection_change</a></div><div class="ttdeci">bool handle_connection_change(bool connected)</div><div class="ttdoc">Handle BLE connection state change.</div><div class="ttdef"><b>Definition</b> SensorStateMachine.cpp:43</div></div>
</div><!-- fragment --><p><b>States:</b></p><ul>
<li><code>Disconnected</code>: No BLE connection</li>
<li><code>Waiting</code>: Connected, waiting for measurement request</li>
<li><code>Running</code>: Actively taking and sending measurements</li>
</ul>
<h1><a class="anchor" id="autotoc_md32"></a>
Key Design Principles</h1>
<ol type="1">
<li><b>Separation of Concerns</b>: Pin reading, event handling, and BLE communication are separate systems</li>
<li><b>State Validation</b>: The state machine ensures operations only occur in valid states</li>
<li><b>Event-Driven</b>: Components communicate through events rather than direct calls</li>
<li><b>Platform Abstraction</b>: Use appropriate drivers for your platform (Arduino, Native, etc.)</li>
</ol>
<h1><a class="anchor" id="autotoc_md33"></a>
Customization Points</h1>
<ul>
<li><b>Sensor Reading</b>: Implement your own <code>read_temperature_sensor()</code> function for different sensors (TMP36, DS18B20, etc.)</li>
<li><b>Pin Configuration</b>: Change pin assignments by modifying the pin number in <code><a class="el" href="classGPIO_1_1Pin.html" title="Lightweight handle to a GPIO pin; forwards calls to the active driver.">GPIO::Pin</a> temp_pin(A0)</code></li>
<li><b>ADC Resolution</b>: Adjust <code><a class="el" href="namespaceGPIO.html#a5a7668181ca7c5dd6dff03d018d2fe06" title="Configure analog conversion and PWM resolution for the platform.">GPIO::setAnalogReadResolution()</a></code> for different precision needs</li>
<li><b>Voltage Reference</b>: Modify voltage calculation if using different reference voltages</li>
<li><b>Measurement Interval</b>: Adjust <code>set_measurement_interval_ms()</code> for your needs</li>
<li><b>Event Handlers</b>: Add custom logic in event handler functions</li>
<li><b>State Actions</b>: Configure state machine callbacks for debugging/monitoring </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8
</small></address>
</body>
</html>
